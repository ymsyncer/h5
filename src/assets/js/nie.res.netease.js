var MobileShare=function(){function e(){var e=location.search.replace(/^[\?|\&]/gi,"");e=""==e?"":"&"+e,w(e,"mbshare")?nie.config.stats.url.add(location.host+location.pathname+"?click=2ndvisite"+e,"\u4e8c\u6b21\u4f20\u64ad\u8bbf\u95ee"):nie.config.stats.url.add(location.host+location.pathname+"?click=1stvisite"+e,"\u76f4\u63a5\u8bbf\u95ee")}function n(e){_=$.extend({title:"",desc:"",url:window.location.href,imgurl:"",circleTitle:"",guideText:"",qrcodeIcon:"",shareCallback:function(){},wxSdkApiSetting:{isDebug:!1,apiList:[],callback:function(){}}},e||{}),C.title=_.title,C.desc=_.desc,C.url=_.url,C.imgurl=_.imgurl,C.circleTitle=_.circleTitle,C.weiboTitle=_.weiboTitle,C.qrcodeIcon=_.qrcodeIcon,C.callback=_.shareCallback;var n=document.createElement("link");n.href="https://nie.res.netease.com/comm/js/nie/util/mobishare2/css/mobile-share.css",n.rel="stylesheet",document.head.appendChild(n),l(),h(),i()}function i(){q?o():N?a():d()}function t(){var e=window.YixinJSBridge;e&&(e.call("showOptionMenu"),e.on("menu:share:appmessage",function(){e.invoke("sendAppMessage",{img_url:C.imgurl,img_width:"640",img_height:"640",link:f("yx_2"),desc:C.desc,title:C.title},function(e){v({channel:"yx",type:2}),C.callback({type:2,res:e})})}),e.on("menu:share:timeline",function(){e.invoke("shareTimeline",{img_url:C.imgurl,img_width:"640",img_height:"640",link:f("yx_1"),desc:C.desc,title:C.title},function(e){v({channel:"yx",type:1}),C.callback({type:1,res:e})})}),y=!0)}function a(){y?t():document.addEventListener("YixinJSBridgeReady",t,!1)}function c(){var e=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"].concat(_.wxSdkApiSetting.apiList);wx.config({debug:_.wxSdkApiSetting.isDebug,appId:wx_conf.appId,timestamp:wx_conf.timestamp,nonceStr:wx_conf.nonceStr,signature:wx_conf.signature,jsApiList:e}),wx.ready(function(){y=!0,"function"==typeof _.wxSdkApiSetting.callback&&_.wxSdkApiSetting.callback(),s()})}function s(){var e={imgUrl:C.imgurl,cancel:function(e){C.callback({type:0,res:e})},fail:function(e){C.callback({type:-1,res:e})}};wx.onMenuShareAppMessage($.extend({title:C.title,desc:C.desc,link:f("wx_2"),success:function(e){v({channel:"wx",type:2}),C.callback({type:2,res:e})}},e)),wx.onMenuShareTimeline($.extend({title:""!=C.circleTitle?C.circleTitle:C.title,desc:C.Desc,link:f("wx_1"),success:function(e){v({channel:"wx",type:1}),C.callback({type:1,res:e})}},e)),wx.onMenuShareQQ($.extend({title:C.title,desc:C.desc,link:f("wx_3"),success:function(e){v({channel:"wx",type:3}),C.callback({type:3,res:e})}},e)),wx.onMenuShareWeibo($.extend({title:C.title,desc:C.desc,link:f("wx_4"),success:function(e){v({channel:"wx",type:4}),C.callback({type:4,res:e})}},e))}function o(){if(y)s();else{var e=!1,n=!1,i=document.createElement("script");i.type="text/javascript",document.body.appendChild(i);var t=document.createElement("script");t.type="text/javascript",document.body.appendChild(t),i.addEventListener("load",function(){e=!0,e&&n&&c()},!1),t.addEventListener("load",function(){n=!0,e&&n&&c()},!1),i.src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js",t.src="https://wxsign.nie.netease.com/sharecom/wxjs.php?url="+encodeURIComponent(location.href)}}function l(){var e=document.createElement("div");if(e.id="NIE-share-m",e.className="NIE-share-m",document.body.appendChild(e),S){var n='<div class="NIE-share-guide"><div class="arrow_line"><em></em><i></i><span></span></div><p>$shareGuide$</p></div>';e.innerHTML=n.replace(/\$shareGuide\$/gi,_.guideText)}else{var n='<div class="NIE-share_ctrl" ><div class="NIE-share_buttons" ><a class="NIE-share-btn_cp" href="javascript:void(0)"><i class="sharefont">&#xa0004;</i><em>\u590d\u5236\u94fe\u63a5</em></a><a class="NIE-share-btn_wx" href="javascript:void(0)"><i class="sharefont">&#xa0005;</i><em>\u5fae\u4fe1</em></a><a class="NIE-share-btn_yx" href="javascript:void(0)"><i class="sharefont">&#xa0002;</i><em>\u6613\u4fe1</em></a><a class="NIE-share-btn_wb" href="javascript:void(0)"><i class="sharefont">&#xa0003;</i><em>\u5fae\u535a</em></a><a class="NIE-share-btn_qq" href="javascript:void(0)"><i class="sharefont">&#xa0006;</i><em>QQ\u7a7a\u95f4</em></a></div><div class="NIE-share_qrcode" ><div ><a class="NIE-btn-close "><i class="sharefont ">&#xa0001;</i></a><p>'+T.qnCoder+'</p><span></span></div></div><div class="NIE-share_link" ><div ><a class="NIE-btn-close "><i class="sharefont ">&#xa0001;</i></a><p>'+T.copyLink+"</p><span></span></div></div></div>";e.innerHTML=n}E=$(e)}function d(){x="http://open.yixin.im/share?appkey=yx3ae08a776bf04178a583cb745fb6aa0c&type=webpage&url="+encodeURIComponent(f("yx_1"))+"&title="+encodeURIComponent(C.title)+"&desc="+encodeURIComponent(C.desc)+"&pic="+encodeURIComponent(C.imgurl),I="http://service.weibo.com/share/share.php?c=nie&content=gb2312&source=nie&title="+encodeURIComponent(C.weiboTitle?C.weiboTitle:C.circleTitle?C.circleTitle:C.title)+"&url="+encodeURIComponent(f("weibo"))+"&pic="+encodeURIComponent(C.imgurl),k="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(f("qqzone"))+"&title="+encodeURIComponent(C.title)+"&desc="+encodeURIComponent(C.desc)+"&pics="+encodeURIComponent(C.imgurl),E.find(".NIE-share_link div span")[0].innerHTML=f("cplink")}function p(){var e=E.find(".NIE-share_ctrl");e.removeClass(e.hasClass("show_qrcode")?"show_qrcode":"show_link")}function h(){E[0].addEventListener("click",function(e){var n=e.target;if($(n).hasClass("NIE-btn-close")||$(n).parent().hasClass("NIE-btn-close"))p(),e.stopPropagation();else if($(n).hasClass("NIE-share_buttons")||$(n).hasClass("NIE-share_qrcode")||$(n).hasClass("NIE-share_link")||$(n).hasClass("NIE-share-m")){E.removeClass("show");{setTimeout(function(){E.hide(),p()},300)}}},!1),E[0].addEventListener("touchmove",function(e){e.preventDefault()},!1),S||(E.find(".NIE-share-btn_cp")[0].addEventListener("click",function(e){E.find(".NIE-share_ctrl").addClass("show_link"),e.stopPropagation()},!1),E.find(".NIE-share-btn_wx")[0].addEventListener("click",function(e){u(),E.find(".NIE-share_ctrl").addClass("show_qrcode"),e.stopPropagation()},!1),E.find(".NIE-share-btn_yx")[0].addEventListener("click",function(){location.href=x},!1),E.find(".NIE-share-btn_wb")[0].addEventListener("click",function(){location.href=I},!1),E.find(".NIE-share-btn_qq")[0].addEventListener("click",function(){location.href=k},!1))}function u(){var e=E.find(".NIE-share_qrcode span");if(0==e.find("img").length){var n=document.createElement("img");n.src="https://qrcode2.webapp.163.com/l?d="+encodeURIComponent(f("qrcode"))+"&l="+encodeURIComponent(C.qrcodeIcon?C.qrcodeIcon:g),e.append(n)}else L&&(e.find("img")[0].src="https://qrcode2.webapp.163.com/l?d="+encodeURIComponent(f("qrcode"))+"&l="+encodeURIComponent(C.qrcodeIcon?C.qrcodeIcon:g),L=!1)}function f(e){var n=window.location.href,i=w(n,"mbshare"),t=parseInt(w(n,"spreadtimes")?w(n,"spreadtimes"):0),a=C.url;return n.indexOf(a)>-1&&(a=n,window.location.hash&&(a=a.replace(window.location.hash,encodeURI(window.location.hash)))),w(a,"mbshare")?a=a.replace("mbshare="+i,"mbshare="+e).replace("spreadtimes="+t,"spreadtimes="+(t+1)):(a+=-1==a.indexOf("?")?"?":"&",a+="mbshare="+e+"&spreadtimes="+(t+1)),a}function v(e){var n=$.extend({channel:"",type:""},e||{});nie.config.stats.url.add(location.host+location.pathname+"?click=share&channel="+n.channel+"&type="+n.type,"\u5206\u4eab\u7edf\u8ba1")}function w(e,n){var i=e;return r=new RegExp("[?&]*"+n+"=([^&]+)"),m=i.match(r),m?m[1].replace('"',""):null}function b(){E.show();setTimeout(function(){E.addClass("show")},50)}var g="https://nie.res.netease.com/comm/js/nie/util/mobishare2/logo_min.png";e();var x,I,k,_,E,y=!1,C={title:"",desc:"",url:"",imgurl:"",circleTitle:"",weiboTitle:"",qrcodeIcon:"",shareCallback:function(){}},q=/micromessenger/i.test(navigator.userAgent.toLowerCase()),N=/yixin/i.test(navigator.userAgent.toLowerCase()),S=q||N,T={qnCoder:"\u957f\u6309\u4fdd\u5b58\u4e8c\u7ef4\u7801\u5230\u672c\u5730<br />\u4f7f\u7528\u5fae\u4fe1\u8bc6\u522b\u8fdb\u884c\u5206\u4eab",copyLink:"\u957f\u6309\u94fe\u63a5\u590d\u5236\u540e\u5206\u4eab\u7ed9\u597d\u53cb"},L=!1;return{init:function(e){n(e)},updateShare:function(e){C=$.extend(C,e||{}),i(),L=!0},showShare:b}}();
